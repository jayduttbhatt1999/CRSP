<!--this Base file is used in some templates -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <!--Font awesome icons -->
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
      crossorigin="anonymous"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css'>

    <style media="screen">


footer{
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    position: relative;
    top: 80px;
    bottom: 0;
    left: 0;
    right: 0;
    background: #012950f5;
    height: auto;
    width: 100vw;

    padding-top: 40px;
    color: #fff;
}
.footer-content{
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
}
.footer-content h3{
    font-size: 2.1rem;
    font-weight: 500;
    text-transform: capitalize;
    line-height: 3rem;
}
.footer-content p{
    max-width: 500px;
    margin: 10px auto;
    line-height: 28px;
    font-size: 14px;
    color: #cacdd2;
    justify-content: center;
    text-align: center;
}
.socials{
    list-style: none;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 1rem 0 3rem 0;
}
.socials li{
    margin: 0 10px;
}
.socials a{
    text-decoration: none;
    color: #fff;
    border: 1.1px solid white;
    padding: 5px;
    border-radius: 50%;

}
.socials a i{
    font-size: 1.1rem;
    width: 20px;
    transition: color .4s ease;

}
.socials a:hover i{
    color: #cfd2d6;
}

.footer-bottom{
    background: #000;
    width: 100vw;
    padding: 20px;
padding-bottom: 40px;
    text-align: center;
}
.footer-bottom p{
float: left;
    font-size: 14px;
    word-spacing: 2px;
    text-transform: capitalize;
}
.footer-bottom p a{
  color:#cfd2d6;
  font-size: 16px;
  text-decoration: none;
}
.footer-bottom span{
    text-transform: uppercase;
    opacity: .4;
    font-weight: 200;
}
.footer-menu{
  float: right;

}
.footer-menu ul{
  display: flex;
}
.footer-menu ul li{
padding-right: 10px;
display: block;
}
.footer-menu ul li a{
  color: #cfd2d6;
  text-decoration: none;
}
.footer-menu ul li a:hover{
  color: #cfd2d6;
}

@media (max-width:500px) {
.footer-menu ul{
  display: flex;
  margin-top: 10px;
  margin-bottom: 20px;
}
}



      @import url(https://fonts.googleapis.com/css?family=Righteous);
      a{
        transition: all 0.3s;
      }
      a:hover {
        transform: scale(1.1);
      }
      button{
        transition: all 0.2s;
      }
      button:hover{
        transform: scale(1.1);
      }


#hover-underline-animation {
  display: inline-block;
  position: relative;
}

#hover-underline-animation:after {
  content: '';
  position: absolute;
  width: 100%;
  transform: scaleX(0);
  height: 2px;
  bottom: 0;
  left: 0;
  background-color: white;
  transform-origin: bottom right;
  transition: transform 0.25s ease-out;
}

#hover-underline-animation:hover:after {
  transform: scaleX(1);
  transform-origin: bottom left;
}


label[id*='important']::after {content: "*"; color:red;} 
      
    </style>

    <title>{% block title %} {% endblock %}</title>
  </head>

  <body>
    <!-- original nav -->
    <nav class="navbar navbar-expand-md navbar-dark navbar-fixed-top" style="background-color: #012950f5">
      <div class="container">
        <a class="navbar-brand" href="{% url 'index' %}" style="font-family: 'Righteous', serif;">UWinCRSP</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" id="hover-underline-animation" href="{% url 'index' %}" style="color: azure; font-family: 'Righteous', serif;">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="hover-underline-animation" href="{% url 'dashboard' %}" style="color: azure; font-family: 'Righteous', serif;">Dashboard</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fas fa-user"></i> {{ user.username }}
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="{% url 'profile' user.username%}">Profile</a>
                  <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                </div>
              </li>
          </ul>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link notification-icon" href="#" onclick="fetchNotifications()"><i class="fa fa-bell mt-1"></i></a>
          <span id="bell-icon-count" class="badge badge-pill badge-danger" style="display: none;"></span>
          <div id="notification-dropdown" class="dropdown-content">
              <div id="notification-dropdown-content"></div>
      </li>
              <div class="notification-icon">
                        <a href="#" onclick="fetchReceivedCollabRequests()">
                            <i class="fa fa-handshake-o" aria-hidden="true"></i>
                            {% if collaboration_notifications_count > 0 %}
                                <span class="badge badge-pill badge-danger">{{ collaboration_notifications_count }}</span>
                            {% endif %}
                        </a>
                        <div id="notification-dropdown" class="dropdown-content">
                            <div id="notification-dropdown-content">
                            </div>
                        </div>
                    </div>&nbsp;&nbsp;
    </ul>
    <form method="post" action="{% url 'search_publishers_' %}">
                {% csrf_token %}
                    <div class="input-group mb-3 mt-2" style="width: 220px;">
                        <input class="form-control" type="search" name="searched" placeholder="Find Uwin Publishers"
                               aria-label="Search">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary my-2 my-sm-0" type="submit"><i class="fa fa-search"></i></button>
                        </div>
                    </div>
                </form>
      {% else %}
       <li class="nav-item">
        <a class="nav-link" href="{% url 'index' %}">Home</a>
      </li>
       <li class="nav-item">
        <a class="nav-link" href="{% url 'login' %}">Login</a>
      </li> <li class="nav-item">
        <a class="nav-link" href="{% url 'registration' %}">Register</a>
      </li>
    {% endif %}
  </div>
</nav>
</div>
    <!--Any flash messages pop up in any page because this is the base template-->
    {% if messages %}
    <div class="alert alert-dismissible" role="alert">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
      <button
        type="button"
        class="close"
        data-dismiss="alert"
        aria-label="Close"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    {% endif %}
    <div>{% block content %}
      {% endblock %}</div>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <!-- A plugin for password show/hide  -->
    <script src="https://unpkg.com/bootstrap-show-password@1.2.1/dist/bootstrap-show-password.min.js"></script>

    <footer>

      <div class="footer-content">
        <h3>UWinCRSP</h3>
        <p>With UWinCRSP, you can easily look for researchers in your field and collaborate, share, discuss, or connect.</p>
        <ul class="socials">
            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
            <li><a href="#"><i class="fa fa-instagram"></i></a></li>
            <li><a href="#"><i class="fa fa-linkedin-square"></i></a></li>
        </ul>
    </div>
    <div class="footer-bottom">
        <p>copyright &copy; <a href="#">UWinCRSP</a>  </p>
                <div class="footer-menu">
                  <ul class="f-menu">
                    <li><a href="">Home</a></li>
                    <li><a href="">About</a></li>
                    <li><a href="">Contact</a></li>
                  </ul>
                </div>
    </div>

    </footer>
    <script>

        function fetchReceivedCollabRequests() {
        var dropdown = document.getElementById("notification-dropdown");
        var content = document.getElementById("notification-dropdown-content");

        // Make an AJAX request to fetch received collaboration requests from the server
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "{% url 'collaboration_notifications' %}", true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var data = JSON.parse(xhr.responseText);
                content.innerHTML = "";
                {#// Clear any existing notifications#}
                data.notifications.forEach(notification => {
                    var notificationItem = document.createElement("div");
                    notificationItem.classList.add("notification-item");
                    if (notification.is_read) {
                        notificationItem.classList.add("read");
                    } else {
                        notificationItem.classList.add("unread");
                    }

                    var messageParagraph = document.createElement("p");
                    messageParagraph.textContent = "you have a new collab request for your recent post "

                    var createdParagraph = document.createElement("p");
                    createdParagraph.innerHTML = "<small>" + notification.created_at + "</small>";

                    notificationItem.appendChild(messageParagraph);
                    notificationItem.appendChild(createdParagraph);
                    content.appendChild(notificationItem);
                });

                {#// Show the dropdown after fetching and displaying the received collaboration requests#}
                dropdown.classList.toggle("show");
            }
        };
        xhr.send();
    }
function fetchNotifications() {
  var dropdown = document.getElementById("notification-dropdown");
  var content = document.getElementById("notification-dropdown-content");

  // Making an AJAX request to fetch notifications from the server
  var xhr = new XMLHttpRequest();
  xhr.open("GET", "{% url 'notifications' %}", true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      var data = JSON.parse(xhr.responseText);
      content.innerHTML = ""; // Clear any existing notifications
      data.notifications.forEach(notification => {
        var notificationItem = document.createElement("div");
        notificationItem.classList.add("notification-item");
        if (notification.is_read) {
          notificationItem.classList.add("read");
        } else {
          notificationItem.classList.add("unread");
        }

        var messageParagraph = document.createElement("p");
        messageParagraph.textContent = notification.message;

        var createdParagraph = document.createElement("p");
        createdParagraph.innerHTML = "<small>" + notification.created_at + "</small>";

        notificationItem.appendChild(messageParagraph);
        notificationItem.appendChild(createdParagraph);
        content.appendChild(notificationItem);
      });

      // Show the dropdown after fetching and displaying the notifications
      dropdown.classList.add("show");

      // Update the bell icon count and make it always visible
      {#var bellIconCount = document.getElementById("bell-icon-count");#}
      {#bellIconCount.textContent = data.notifications.length;#}
      {#bellIconCount.style.display = "inline";#}
    }
  };
  xhr.send();
}

// Event listener to toggle the visibility of the dropdown when the bell icon is clicked
function toggleDropdown() {
  var dropdown = document.getElementById("notification-dropdown");
  dropdown.classList.toggle("show");
}

// Event listener to hide the dropdown when someone clicks outside of it
document.addEventListener("click", function(event) {
  var dropdown = document.getElementById("notification-dropdown");
  if (!dropdown.contains(event.target)) {
    dropdown.classList.remove("show");
  }
});
    </script>

  </body>
</html>
