{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <div class="form-group">
            <h2>Research Collaboration Opportunities</h2>
            {% if posts %}
                <ul class="list-group ">
                    {% for post in posts %}
                        <br><br>
                        <li class="list-group-item">
                            <h3>{{ post.user.first_name }} {{ post.user.last_name }} posted this
                                on {{ post.created_at }}</h3>
                            <div class="container details-container">
                                <div class="post-details">
                                    <h4 class="post-title">Title: {{ post.title }}</h4>
                                    <p class="post-description">Description: {{ post.description }}</p>
                                    <p class="post-info"><strong>Required
                                        Expertise:</strong> {{ post.required_expertise }}</p>
                                    <p class="post-info"><strong>Collaboration
                                        Format:</strong> {{ post.collaboration_format }}</p>
                                    <p class="post-info"><strong>Posted on:</strong> {{ post.created_at }}</p>
                                </div>
                            </div>

                            <button class="btn btn-primary"
                                    onclick="sendCollaborationRequest('{{ post.id }}', '{{ post.user.username }}' , '{{ post.title }}')">
                                Collaborate
                            </button>
                            {#                            <button type="button" class="btn btn-primary"#}
                            {#                                    onclick="collaborate('{{ post.id }}', '{{ post.user.username }}')">#}
                            {#                                Collaborate#}
                            {#                            </button>#}
                            <br><br>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No collaboration opportunities available.</p>
            {% endif %}
            <!-- JavaScript to handle collaboration button click -->
            <script>
                function sendCollaborationRequest(postId, username, title) {
                    // Send AJAX request to send collaboration request
                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '/send_collaboration_request/' + postId + '/');
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.onload = function () {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                alert("Collaboration request sent to " + username + " for the post " + "'" + title + "'");
                                // Success! Handle any UI changes here if needed.
                            } else {
                                alert(response.message);
                            }
                        } else {
                            alert("Error sending collaboration request.");
                        }
                    };
                    xhr.onerror = function () {
                        alert("Error sending collaboration request.");
                    };
                    xhr.send(JSON.stringify({post_id: postId}));
                }
            </script>
        </div>
    </div>
{% endblock %}
<style>
    .list-group-item {
        background-color: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .list-group-item h3 {
        font-size: 20px;
        margin-bottom: 10px;
    }

    .details-container {
        background-color: #f9f9f9;
        padding: 15px;
        border: 1px solid #d0d0d0;
        border-radius: 5px;
    }

    .details-container h4 {
        font-size: 18px;
        margin-top: 0;
        margin-bottom: 10px;
    }

    .details-container p {
        font-size: 14px;
        margin-bottom: 5px;
    }

    .container {
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 20px;
    }

    .post-details {
        font-family: 'Arial', sans-serif;
        color: #333;
    }

    .post-title {
        font-size: 24px;
        margin-top: 0;
        margin-bottom: 10px;
    }

    .post-description {
        font-size: 16px;
        margin-bottom: 15px;
    }

    .post-info {
        font-size: 14px;
        margin-bottom: 5px;
    }

    strong {
        color: #666;
    }
</style>
